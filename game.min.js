(()=>{"use strict";const t={game:{spawnerRadius:110,timePerSpawn:15e3,timePerLevel:6e4,timePerSurvivalScore:5e3,survivalAsteroidBonus:.2,survivalLevelBonus:1,itemDropMultiplierWhenExploreToChild:.2,itemDropMultiplierUseSpecialAmmo:.05,multiDrop:!1,tick:58},asteroid:{spin:.3,damagePerRadius:.25,childrenSizeRatio:.65,minimalSizeCanSplit:30,minNumberOfChild:1,maxNumberOfChild:2,minSize:60,maxSize:100,minSpeed:0,maxSpeed:4},ship:{health:100,speed:4,spin:.3,size:20},ammo:{damage:10,destroyAsteroidRate:.6,speed:8,size:25},items:{ammos:{ammo1:"Blue",ammo2:"Red",ammo3:"Bomb"},item0:{name:"Blue Ammo",amount:3,rate:.11},item1:{name:"Burger",heal:15,rate:.2},item2:{name:"Red Ammo",amount:1,rate:.015},item3:{name:"Antimatter Bomb",amount:1,rate:.01},item4:{name:"Gold",rate:.3,score:30}},...window.gameConfig||{}},e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),s=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),i=e-6,o=s-6,h=Math.min(1,1-(1920-Math.max(e,500))*(.4/1420),1-5e-4*(900-Math.max(s,500)));console.log(`Resolution: ${e} x ${s} (${h})`);const a=document.getElementById("img-dir"),m=document.getElementById("screen"),r=m.getContext("2d");if(window.devicePixelRatio){const t=Math.ceil(window.devicePixelRatio);m.style.width=`${i}px`,m.style.height=`${o}px`,m.width=i*t,m.height=o*t,r.scale(t,t)}function n(t){let e,s,i,o=~~(6*t),h=6*t-o,a=1-h;switch(o%6){case 0:e=1,s=h,i=0;break;case 1:e=a,s=1,i=0;break;case 2:e=0,s=1,i=h;break;case 3:e=0,s=a,i=1;break;case 4:e=h,s=0,i=1;break;case 5:e=1,s=0,i=a}return"#"+("00"+(~~(255*e)).toString(16)).slice(-2)+("00"+(~~(255*s)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)}function l(t,e=0){return t===e?t:(t-=e,Math.round(Math.random()*t+e))}function d(t){return Math.random()<=t}function p(t,e){return Math.sqrt(Math.abs(t)*Math.abs(t)+Math.abs(e)*Math.abs(e))}function c(t,e=!1,s=t.imgId){const i=document.getElementById(s);r.beginPath(),r.save(),e&&(r.shadowOffX=10,r.shadowOffY=10,r.shadowBlur=20,r.shadowColor=t.color),r.translate(t.x,t.y),r.rotate(t.angle*Math.PI/180),r.drawImage(i,-t.radius-1,-t.radius-1,2*t.radius+2,2*t.radius+2),r.restore()}function u(t){return t*h}class g{constructor(e,s,h,a,m,r,d,p){this.imgId=d||function(){let t="rock";return t+=l(7,0)+"",t}(),this.spinSpeed=0===p?0:p||t.asteroid.spin,this.isExist=!0,this.x=e||i/2,this.y=s||o/2,this.color=a||n(Math.random()),this.radius=u(h||l(t.asteroid.maxSize,t.asteroid.minSize)),this.xSpeed=u(m||l(t.asteroid.maxSpeed,t.asteroid.minSpeed)),this.ySpeed=u(r||l(t.asteroid.maxSpeed,t.asteroid.minSpeed)),this.angle=0,this.damage=this.radius*t.asteroid.damagePerRadius}increaseAngle(t){this.angle=this.angle+t,this.angle>=360&&(this.angle=0)}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.spinSpeed&&this.increaseAngle(p(this.xSpeed,this.ySpeed)*this.spinSpeed)}relocate(t,e,s){const i=this.radius+s,o=p(this.x-t,this.y-e);i>o&&(this.x=(this.x-t)*(i/o)+t,this.y=(this.y-e)*(i/o)+e)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=i-this.radius?(this.x=i-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=o-this.radius&&(this.y=o-this.radius,this.ySpeed*=-1)}toBall(t){for(const e of t){const t=e.radius+this.radius,s=p(e.x-this.x,e.y-this.y);if(0!==s&&(t>s&&this.relocate(e.x,e.y,e.radius),t>=s)){const s=((this.radius-e.radius)*this.xSpeed+2*e.radius*e.xSpeed)/t,i=((this.radius-e.radius)*this.ySpeed+2*e.radius*e.ySpeed)/t,o=((e.radius-this.radius)*e.xSpeed+2*this.radius*this.xSpeed)/t,h=((e.radius-this.radius)*e.ySpeed+2*this.radius*this.ySpeed)/t;this.xSpeed=s,this.ySpeed=i,e.xSpeed=o,e.ySpeed=h}}}toObj(t){const e=this.radius+t.radius,s=p(this.x-t.x,this.y-t.y);if(0!==s&&(s<e&&this.relocate(t.x,t.y,t.radius),s<=e))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(t){for(let e=0;e<t.length;e++)if(t[e].radius+this.radius>=p(t[e].x-this.x,t[e].y-this.y))return e;return-1}remove(t){this.isExist=!1;for(let e=0;e<t.length;e++)t[e].isExist||t.splice(e,1)}explore(e){this.remove(e);const s=l(t.asteroid.maxNumberOfChild,t.asteroid.minNumberOfChild);if(s&&this.canExploreToSmaller())for(let i=0;i<s;i++)e.push(new g(this.x,this.y,this.radius*t.asteroid.childrenSizeRatio,this.color,void 0,void 0,this.imgId))}canExploreToSmaller(){return this.radius>t.asteroid.minimalSizeCanSplit}spawn(t,e=1){for(let s=0;s<e;s++)t.push(new g(this.x,this.y,void 0,this.color))}makeExplosive(t,e){l(1,0)?(t.push(new x(this.x,this.y,2*this.radius,"explosive0",e)),t.push(new x(this.x,this.y,1.2*this.radius,void 0,e))):l(1,0)?t.push(new x(this.x,this.y,2*this.radius,void 0,e)):(t.push(new x(this.x,this.y,3.5*this.radius,"explosive4",e)),t.push(new x(this.x,this.y,1*this.radius,void 0,e)))}}class x extends g{constructor(t,e,s,i,o){super(t,e,s,"yellow",.2,.2),this.imgId=i||function(){let t="explosive";return t+=l(4,0)+"",t}(),this.count=50*o||50}drawExplosive(t){this.count>0?(c(this,!1),this.count-=1):this.remove(t)}}class v extends g{constructor(e,s,i,o,h,a){super(e,s,a||t.ammo.size,"green",i,o),this.imgId=h||"ammo0",this.damage=t.ammo.damage}}class w extends g{constructor(t,e,s,i=25){super(t,e,i,"blue",.5,.5),this.imgId=s||"item0"}doFunc(e){switch(this.imgId){case"item0":for(let s=0;s<t.items.item0.amount;s++)e.totalAmmo.push(new v(e.x,e.y,1,1,"ammo1",30));break;case"item1":e.health+=t.items.item1.heal;break;case"item2":for(let s=0;s<t.items.item2.amount;s++)e.totalAmmo.push(new v(e.x,e.y,1,1,"ammo2",30));break;case"item3":for(let s=0;s<t.items.item3.amount;s++)e.totalAmmo.push(new v(e.x,e.y,1,1,"ammo3",30))}}}class S extends g{constructor(e,s,i,o,h,a){super(e,s,t.ship.size,h,.2,.2),this.color=h||"white",this.imgId=a||"ship",this.speed=u(i||t.ship.speed),this.health=o||t.ship.health,this.spinSpeed=t.ship.spin,this.totalAmmo=[]}shoot(e,s=this.angle,i,o){const h=u(t.ammo.speed)*Math.cos((s-90)*Math.PI/180),a=u(t.ammo.speed)*Math.sin((s-90)*Math.PI/180),m=this.x+(this.radius+u(t.ammo.size)+1)*Math.cos((s-90)*Math.PI/180),r=this.y+(this.radius+u(t.ammo.size)+1)*Math.sin((s-90)*Math.PI/180);e.push(new v(m,r,h,a,i,o))}moveLeft(){this.xSpeed>=-this.speed&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=this.speed&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=-this.speed&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=this.speed&&(this.ySpeed=this.speed,this.xSpeed=0)}}class f extends g{constructor(){super(void 0,void 0,t.game.spawnerRadius,void 0,0,0,"center")}}window.game=new class{constructor(){this.update=!0,this.loops=[],this.level=0,this.score=0,this.items=[],this.ship=new S(200,800),this.spawner=new f,this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const e of this.items)e.toBall(this.items),e.toObj(this.spawner),e.toEdge(),e.toObj(this.ship)&&("item4"===e.imgId&&(this.score+=t.items.item4.score),e.doFunc(this.ship),e.remove(this.items)),e.makeAMove()}specialAmmoState(){for(const t of this.spammos){if(t.toObj(this.ship)&&"ammo1"===t.imgId&&(this.ship.health-=t.damage),"ammo3"===t.imgId){for(const t of this.balls)t.makeExplosive(this.explosive);for(const t of this.ammos)this.explosive.push(new x(t.x,t.y,t.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=this.spammos.filter((e=>e!==t))}"ammo2"===t.imgId&&(t.toEdge(),t.toObj(this.spawner),t.toObj(this.ship)&&(this.ship.health+=3)),t.makeAMove()}}ammoState(){for(const e of this.ammos){if(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health-=e.damage),e.toArrOfObj(this.balls)>=0){const s=this.balls[e.toArrOfObj(this.balls)];d(t.ammo.destroyAsteroidRate)?s.canExploreToSmaller()?(s.explore(this.balls),s.makeExplosive(this.explosive),e.remove(this.ammos),this.score+=5,this.spawnItemFrom(s,t.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(s):e.toBall(this.balls)}e.makeAMove()}}ballState(){for(const e of this.balls)e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(e.explore(this.balls),this.ship.health-=e.damage,this.score-=10,e.makeExplosive(this.explosive)),e.toArrOfObj(this.ammos)>=0&&(d(t.ammo.destroyAsteroidRate)?(this.ammos[e.toArrOfObj(this.ammos)].remove(this.ammos),e.makeExplosive(this.explosive),e.canExploreToSmaller()?(e.explore(this.balls),this.score+=5,this.spawnItemFrom(e,t.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(e)):e.toBall(this.ammos)),e.toArrOfObj(this.spammos)>=0&&(d(t.ammo.destroyAsteroidRate)?e.remove(this.balls):e.canExploreToSmaller()?e.explore(this.balls):e.remove(this.balls),this.spawnItemFrom(e,t.game.itemDropMultiplierUseSpecialAmmo),e.makeExplosive(this.explosive),this.score+=5),e.toBall(this.balls),e.makeAMove()}spawnItemFrom(e,s=1){e.remove(this.balls),e.makeExplosive(this.explosive,.3),this.score+=5,d(t.items.item0.rate*s)&&(this.items.push(new w(e.x,e.y,"item0")),!t.game.multiDrop)||d(t.items.item1.rate*s)&&(this.items.push(new w(e.x,e.y,"item1")),!t.game.multiDrop)||d(t.items.item2.rate*s)&&(this.items.push(new w(e.x,e.y,"item2")),!t.game.multiDrop)||d(t.items.item3.rate*s)&&(this.items.push(new w(e.x,e.y,"item3")),!t.game.multiDrop)||d(t.items.item4.rate*s)&&this.items.push(new w(e.x,e.y,"item4"))}drawBall(){for(const t of this.balls)c(t)}drawAmmo(){for(const t of this.ammos)c(t,!0)}drawSpecialAmmo(){for(const t of this.spammos)c(t)}drawItem(){for(const t of this.items)c(t)}shipState(){if(this.ship.health<=0){const t=Number(localStorage.getItem("highScore")||"0"),e=Number(localStorage.getItem("highLevel")||"0");t<this.score&&localStorage.setItem("highScore",this.score),e<this.level&&localStorage.setItem("highLevel",this.level),stop(),setTimeout((()=>document.getElementById("overlay").classList.add("visible")),300)}this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(){const i=parseFloat(getComputedStyle(document.documentElement).fontSize);let o=Math.ceil(e/300+i);7.4*o>.4*s&&(o=Math.ceil(s/200+i));const h=Math.min(Math.ceil(.6*o),20),a=Math.floor(2.5*o);r.font=`${o}px Verdana`,r.fillStyle="white",r.fillText("Stage   "+game.level,h,a-Math.ceil(1.2*o)),r.fillText("Health  "+Math.floor(this.ship.health),h,a),r.fillText("Items   "+this.ship.totalAmmo.length,h,a+Math.ceil(1.2*o)),r.fillText("Score   "+this.score,h,a+Math.ceil(4.4*o));const m=this.ship.totalAmmo.length?this.ship.totalAmmo[this.ship.totalAmmo.length-1].imgId:"",n=t.items.ammos[m]||"None";r.fillText("Ammo  "+n,h,a+Math.ceil(2.4*o))}drawExplosion(){for(const t of this.explosive)t.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState(),this.update=!0}redraw(){this.update&&(this.update=!1,r.clearRect(0,0,m.width,m.height),this.drawAmmo(),this.drawSpecialAmmo(),this.drawItem(),this.drawBall(),this.drawExplosion(),c(this.spawner,!0),c(this.ship,!0),this.displayScore())}play(){const e=()=>{this.ship.health>0?(this.combineState(),this.loops.push(setTimeout(e,1e3/t.game.tick))):this.shipState()},s=()=>{this.ship.health>0?(this.redraw(),this.main=requestAnimationFrame(s)):c(this.ship,!1,"explosive1")},i=()=>{this.ship.health>0&&(this.level++,this.loops.push(setTimeout(i,t.game.timePerLevel)))},o=()=>{this.ship.health>0&&(this.spawner.spawn(game.balls,game.level),this.spawner.color=n(Math.random()),this.loops.push(setTimeout(o,t.game.timePerSpawn)))},h=()=>{this.ship.health>0&&(this.score+=game.level*t.game.survivalLevelBonus+Math.floor((game.balls.length+game.ammos.length)*t.game.survivalAsteroidBonus),this.loops.push(setTimeout(h,t.game.timePerSurvivalScore)))};!function(){let t="";for(let e=0;e<8;e++)t+='<img alt="rock" src="img/rock/rock'+e+'.png" id="rock'+e+'" style="display: none">';a.innerHTML+=t}(),function(){let t="";for(let e=0;e<4;e++)t+='<img alt="ammo" src="img/ammo/ammo'+e+'.png" id="ammo'+e+'" style="display: none">';a.innerHTML+=t}(),function(){let t="";for(let e=0;e<5;e++)t+='<img alt="object" src="img/item/item'+e+'.png" id="item'+e+'" style="display: none">';a.innerHTML+=t}(),function(){let t="";for(let e=0;e<6;e++)t+='<img alt="explosive" src="img/explosive/explosive'+e+'.png" id="explosive'+e+'" style="display: none">';a.innerHTML+=t}(),h(),e(),s(),i(),setTimeout(o,2e3),this.keydown=t=>{const e=this;switch(t.key){case"ArrowRight":e.ship.moveRight();break;case"ArrowLeft":e.ship.moveLeft();break;case"ArrowUp":e.ship.moveUp();break;case"ArrowDown":e.ship.moveDown();break;case"a":if(e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}break;case"s":e.ship.shoot(e.ammos,e.ship.angle,"ammo0")}},document.addEventListener("keydown",this.keydown,{passive:!0}),this.mousedown=t=>{const e=this;if(0===t.button&&e.ship.shoot(e.ammos,e.ship.angle,"ammo0"),t.button<=2&&e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}},document.addEventListener("mousedown",this.mousedown,{passive:!0}),this.contextmenu=t=>t.preventDefault(),document.addEventListener("contextmenu",this.contextmenu),this.touchstart=t=>{t.touches.length>1?this.multitouch=t.touches.length:(this.touchX=t.changedTouches[0].screenX,this.touchY=t.changedTouches[0].screenY)},this.touchend=t=>{const e=this;if(this.multitouch){if(this.multitouch--,1===this.multitouch&&e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}return}if(void 0===this.touchX||void 0===this.touchY)return;const s=window.innerWidth||document.body.clientWidth,i=Math.max(1,Math.floor(.01*s)),o=t.changedTouches[0].screenX,h=t.changedTouches[0].screenY,a=this.touchX,m=this.touchY;this.touchY=void 0,this.touchX=void 0;const r=Math.tan(.375*Math.PI);let n=o-a,l=h-m,d=Math.abs(n/l),p=Math.abs(l/n);if(Math.abs(n)>i||Math.abs(l)>i)return p<=r&&(n<0?e.ship.moveLeft():e.ship.moveRight()),void(d<=r&&(l<0?e.ship.moveUp():e.ship.moveDown()));e.ship.shoot(e.ammos,e.ship.angle,"ammo0")},document.addEventListener("touchstart",this.touchstart,{passive:!0}),document.addEventListener("touchend",this.touchend,{passive:!0})}stop(){this.loops.forEach(clearTimeout),cancelAnimationFrame(this.main),document.removeEventListener("keydown",this.keydown),document.removeEventListener("mousedown",this.mousedown),document.removeEventListener("contextmenu",this.contextmenu),document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchend",this.touchend)}},game.play()})();