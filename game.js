(()=>{"use strict";const t=document.getElementById("screen"),e=t.getContext("2d"),s=window.gameConfig||{game:{spawnerRadius:110,timePerSpawn:15e3,timePerLevel:6e4,timePerSurvivalScore:5e3,survivalAsteroidBonus:.2,survivalLevelBonus:1,itemDropMultiplierWhenExploreToChild:.2,itemDropMultiplierUseSpecialAmmo:.05,multiDrop:!1,tick:58},asteroid:{spin:.3,damagePerRadius:.25,childrenSizeRatio:.65,minimalSizeCanSplit:30,minNumberOfChild:1,maxNumberOfChild:3,minSize:60,maxSize:100,minSpeed:0,maxSpeed:4},ship:{health:100,speed:4,spin:.3,size:20},ammo:{damage:10,destroyAsteroidRate:.6,speed:8,size:25},items:{ammos:{ammo1:"Blue",ammo2:"Red",ammo3:"Bomb"},item0:{name:"Blue Ammo",amount:3,rate:.12},item1:{name:"Burger",heal:15,rate:.2},item2:{name:"Red Ammo",amount:1,rate:.015},item3:{name:"Antimatter Bomb",amount:1,rate:.01},item4:{name:"Gold",rate:.3,score:30}}},i=document.getElementById("img-dir");function o(t){let e,s,i,o=~~(6*t),h=6*t-o,a=1-h;switch(o%6){case 0:e=1,s=h,i=0;break;case 1:e=a,s=1,i=0;break;case 2:e=0,s=1,i=h;break;case 3:e=0,s=a,i=1;break;case 4:e=h,s=0,i=1;break;case 5:e=1,s=0,i=a}return"#"+("00"+(~~(255*e)).toString(16)).slice(-2)+("00"+(~~(255*s)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)}function h(t,e=0){return t===e?t:(t-=e,Math.round(Math.random()*t+e))}function a(t){return Math.random()<=t}function m(t,e){return Math.sqrt(Math.abs(t)*Math.abs(t)+Math.abs(e)*Math.abs(e))}function r(t,s=!1,i=t.imgId){const o=document.getElementById(i);e.beginPath(),e.save(),s&&(e.shadowOffX=10,e.shadowOffY=10,e.shadowBlur=20,e.shadowColor=t.color),e.translate(t.x,t.y),e.rotate(t.angle*Math.PI/180),e.drawImage(o,-t.radius-1,-t.radius-1,2*t.radius+2,2*t.radius+2),e.restore()}t.width=window.innerWidth-10,t.height=window.innerHeight-10;class n{constructor(e,i,a,m,r,n,l,d){this.imgId=l||function(t){let e="rock";return e+=h(7,0)+"",e}(),this.spinSpeed=0===d?0:d||s.asteroid.spin,this.isExist=!0,this.x=e||t.width/2,this.y=i||t.height/2,this.color=m||o(Math.random()),this.radius=a||h(s.asteroid.maxSize,s.asteroid.minSize),this.xSpeed=r||h(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.ySpeed=n||h(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.angle=0,this.damage=this.radius*s.asteroid.damagePerRadius}increaseAngle(t){this.angle=this.angle+t,this.angle>=360&&(this.angle=0)}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.spinSpeed&&this.increaseAngle(m(this.xSpeed,this.ySpeed)*this.spinSpeed)}relocate(t,e,s){const i=this.radius+s,o=m(this.x-t,this.y-e);i>o&&(this.x=(this.x-t)*(i/o)+t,this.y=(this.y-e)*(i/o)+e)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=t.width-this.radius?(this.x=t.width-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=t.height-this.radius&&(this.y=t.height-this.radius,this.ySpeed*=-1)}toBall(t){for(const e of t){const t=e.radius+this.radius,s=m(e.x-this.x,e.y-this.y);if(0!==s&&(t>s&&this.relocate(e.x,e.y,e.radius),t>=s)){const s=((this.radius-e.radius)*this.xSpeed+2*e.radius*e.xSpeed)/t,i=((this.radius-e.radius)*this.ySpeed+2*e.radius*e.ySpeed)/t,o=((e.radius-this.radius)*e.xSpeed+2*this.radius*this.xSpeed)/t,h=((e.radius-this.radius)*e.ySpeed+2*this.radius*this.ySpeed)/t;this.xSpeed=s,this.ySpeed=i,e.xSpeed=o,e.ySpeed=h}}}toObj(t){const e=this.radius+t.radius,s=m(this.x-t.x,this.y-t.y);if(0!==s&&(s<e&&this.relocate(t.x,t.y,t.radius),s<=e))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(t){for(let e=0;e<t.length;e++)if(t[e].radius+this.radius>=m(t[e].x-this.x,t[e].y-this.y))return e;return-1}remove(t){this.isExist=!1;for(let e=0;e<t.length;e++)t[e].isExist||t.splice(e,1)}explore(t){this.remove(t);const e=h(s.asteroid.maxNumberOfChild,s.asteroid.minNumberOfChild);if(e&&this.canExploreToSmaller())for(let i=0;i<e;i++)t.push(new n(this.x,this.y,this.radius*s.asteroid.childrenSizeRatio,this.color,void 0,void 0,this.imgId))}canExploreToSmaller(){return this.radius>s.asteroid.minimalSizeCanSplit}spawn(t,e=1){for(let s=0;s<e;s++)t.push(new n(this.x,this.y,void 0,this.color))}makeExplosive(t,e){h(1,0)?(t.push(new l(this.x,this.y,2*this.radius,"explosive0",e)),t.push(new l(this.x,this.y,1.2*this.radius,void 0,e))):h(1,0)?t.push(new l(this.x,this.y,2*this.radius,void 0,e)):(t.push(new l(this.x,this.y,3.5*this.radius,"explosive4",e)),t.push(new l(this.x,this.y,1*this.radius,void 0,e)))}}class l extends n{constructor(t,e,s,i,o){super(t,e,s,"yellow",.2,.2),this.imgId=i||function(t){let e="explosive";return e+=h(4,0)+"",e}(),this.count=50*o||50}drawExplosive(t){this.count>0?(r(this,!1),this.count-=1):this.remove(t)}}class d extends n{constructor(t,e,i,o,h,a){super(t,e,a||s.ammo.size,"green",i,o),this.imgId=h||"ammo0",this.damage=s.ammo.damage}}class p extends n{constructor(t,e,s,i=25){super(t,e,i,"blue",.5,.5),this.imgId=s||"item0"}doFunc(t){switch(this.imgId){case"item0":for(let e=0;e<s.items.item0.amount;e++)t.totalAmmo.push(new d(t.x,t.y,1,1,"ammo1",30));break;case"item1":t.health+=s.items.item1.heal;break;case"item2":for(let e=0;e<s.items.item2.amount;e++)t.totalAmmo.push(new d(t.x,t.y,1,1,"ammo2",30));break;case"item3":for(let e=0;e<s.items.item3.amount;e++)t.totalAmmo.push(new d(t.x,t.y,1,1,"ammo3",30))}}}class c extends n{constructor(t,e,i,o,h,a){super(t,e,s.ship.size,h,.2,.2),this.color=h||"white",this.imgId=a||"ship",this.speed=i||s.ship.speed,this.health=o||s.ship.health,this.spinSpeed=s.ship.spin,this.totalAmmo=[]}shoot(t,e=this.angle,i,o){const h=s.ammo.speed*Math.cos((e-90)*Math.PI/180),a=s.ammo.speed*Math.sin((e-90)*Math.PI/180),m=this.x+(this.radius+s.ammo.size+1)*Math.cos((e-90)*Math.PI/180),r=this.y+(this.radius+s.ammo.size+1)*Math.sin((e-90)*Math.PI/180);t.push(new d(m,r,h,a,i,o))}moveLeft(){this.xSpeed>=-this.speed&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=this.speed&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=-this.speed&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=this.speed&&(this.ySpeed=this.speed,this.xSpeed=0)}}class u extends n{constructor(){super(void 0,void 0,s.game.spawnerRadius,void 0,0,0,"center")}}window.game=new class{constructor(){this.update=!0,this.loops=[],this.level=0,this.score=0,this.items=[],this.ship=new c(200,800),this.spawner=new u,this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const t of this.items)t.toBall(this.items),t.toObj(this.spawner),t.toEdge(),t.toObj(this.ship)&&("item4"===t.imgId&&(this.score+=s.items.item4.score),t.doFunc(this.ship),t.remove(this.items)),t.makeAMove()}specialAmmoState(){for(const t of this.spammos){if(t.toObj(this.ship)&&"ammo1"===t.imgId&&(this.ship.health-=t.damage),"ammo3"===t.imgId){for(const t of this.balls)t.makeExplosive(this.explosive);for(const t of this.ammos)this.explosive.push(new l(t.x,t.y,t.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=this.spammos.filter((e=>e!==t))}"ammo2"===t.imgId&&(t.toEdge(),t.toObj(this.spawner),t.toObj(this.ship)&&(this.ship.health+=3)),t.makeAMove()}}ammoState(){for(const t of this.ammos){if(t.toEdge(),t.toObj(this.spawner),t.toObj(this.ship)&&(this.ship.health-=t.damage),t.toArrOfObj(this.balls)>=0){const e=this.balls[t.toArrOfObj(this.balls)];a(s.ammo.destroyAsteroidRate)?e.canExploreToSmaller()?(e.explore(this.balls),e.makeExplosive(this.explosive),t.remove(this.ammos),this.score+=5,this.spawnItemFrom(e,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(e):t.toBall(this.balls)}t.makeAMove()}}ballState(){for(const t of this.balls)t.toEdge(),t.toObj(this.spawner),t.toObj(this.ship)&&(t.explore(this.balls),this.ship.health-=t.damage,this.score-=10,t.makeExplosive(this.explosive)),t.toArrOfObj(this.ammos)>=0&&(a(s.ammo.destroyAsteroidRate)?(this.ammos[t.toArrOfObj(this.ammos)].remove(this.ammos),t.makeExplosive(this.explosive),t.canExploreToSmaller()?(t.explore(this.balls),this.score+=5,this.spawnItemFrom(t,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(t)):t.toBall(this.ammos)),t.toArrOfObj(this.spammos)>=0&&(a(s.ammo.destroyAsteroidRate)?t.remove(this.balls):t.canExploreToSmaller()?t.explore(this.balls):t.remove(this.balls),this.spawnItemFrom(t,s.game.itemDropMultiplierUseSpecialAmmo),t.makeExplosive(this.explosive),this.score+=5),t.toBall(this.balls),t.makeAMove()}spawnItemFrom(t,e=1){t.remove(this.balls),t.makeExplosive(this.explosive,.3),this.score+=5,a(s.items.item0.rate*e)&&(this.items.push(new p(t.x,t.y,"item0")),!s.game.multiDrop)||a(s.items.item1.rate*e)&&(this.items.push(new p(t.x,t.y,"item1")),!s.game.multiDrop)||a(s.items.item2.rate*e)&&(this.items.push(new p(t.x,t.y,"item2")),!s.game.multiDrop)||a(s.items.item3.rate*e)&&(this.items.push(new p(t.x,t.y,"item3")),!s.game.multiDrop)||a(s.items.item4.rate*e)&&this.items.push(new p(t.x,t.y,"item4"))}drawBall(){for(const t of this.balls)r(t)}drawAmmo(){for(const t of this.ammos)r(t,!0)}drawSpecialAmmo(){for(const t of this.spammos)r(t)}drawItem(){for(const t of this.items)r(t)}shipState(){if(this.ship.health<=0){const t=Number(localStorage.getItem("highScore")||"0"),e=Number(localStorage.getItem("highLevel")||"0");t<this.score&&localStorage.setItem("highScore",this.score),e<this.level&&localStorage.setItem("highLevel",this.level),stop(),setTimeout((()=>document.getElementById("overlay").classList.add("visible")),300)}this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(t,i){e.font="25px Verdana",e.fillStyle="white",e.fillText("Stage   "+game.level,t,i-30),e.fillText("Health  "+Math.floor(this.ship.health),t,i),e.fillText("Items   "+this.ship.totalAmmo.length,t,i+30),e.fillText("Score   "+this.score,t,i+110);const o=this.ship.totalAmmo.length?this.ship.totalAmmo[this.ship.totalAmmo.length-1].imgId:"",h=s.items.ammos[o]||"None";e.fillText("Ammo  "+h,t,i+60)}drawExplosion(){for(const t of this.explosive)t.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState(),this.update=!0}redraw(){this.update&&(this.update=!1,e.clearRect(0,0,t.width,t.height),this.drawAmmo(),this.drawSpecialAmmo(),this.drawItem(),this.drawBall(),this.drawExplosion(),r(this.spawner,!0),r(this.ship,!0),this.displayScore(15,60))}play(){const t=()=>{this.ship.health>0?(this.combineState(),this.loops.push(setTimeout(t,1e3/s.game.tick))):this.shipState()},e=()=>{this.ship.health>0?(this.redraw(),this.main=requestAnimationFrame(e)):r(this.ship,!1,"explosive1")},h=()=>{this.ship.health>0&&(this.level++,this.loops.push(setTimeout(h,s.game.timePerLevel)))},a=()=>{this.ship.health>0&&(this.spawner.spawn(game.balls,game.level),this.spawner.color=o(Math.random()),this.loops.push(setTimeout(a,s.game.timePerSpawn)))},m=()=>{this.ship.health>0&&(this.score+=game.level*s.game.survivalLevelBonus+Math.floor((game.balls.length+game.ammos.length)*s.game.survivalAsteroidBonus),this.loops.push(setTimeout(m,s.game.timePerSurvivalScore)))};!function(t){let e="";for(let t=0;t<8;t++)e+='<img alt="rock" src="img/rock/rock'+t+'.png" id="rock'+t+'" style="display: none">';i.innerHTML+=e}(),function(t){let e="";for(let t=0;t<4;t++)e+='<img alt="ammo" src="img/ammo/ammo'+t+'.png" id="ammo'+t+'" style="display: none">';i.innerHTML+=e}(),function(t){let e="";for(let t=0;t<5;t++)e+='<img alt="object" src="img/item/item'+t+'.png" id="item'+t+'" style="display: none">';i.innerHTML+=e}(),function(t){let e="";for(let t=0;t<6;t++)e+='<img alt="explosive" src="img/explosive/explosive'+t+'.png" id="explosive'+t+'" style="display: none">';i.innerHTML+=e}(),m(),t(),e(),h(),setTimeout(a,2e3),this.keydown=t=>{const e=this;switch(t.key){case"ArrowRight":e.ship.moveRight();break;case"ArrowLeft":e.ship.moveLeft();break;case"ArrowUp":e.ship.moveUp();break;case"ArrowDown":e.ship.moveDown();break;case"a":if(e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}break;case"s":e.ship.shoot(e.ammos,e.ship.angle,"ammo0")}},document.addEventListener("keydown",this.keydown,{passive:!0}),this.mousedown=t=>{const e=this;if(0===t.button&&e.ship.shoot(e.ammos,e.ship.angle,"ammo0"),t.button<=2&&e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}},document.addEventListener("mousedown",this.mousedown,{passive:!0}),this.contextmenu=t=>t.preventDefault(),document.addEventListener("contextmenu",this.contextmenu),this.touchstart=t=>{t.touches.length>1?this.multitouch=t.touches.length:(this.touchX=t.changedTouches[0].screenX,this.touchY=t.changedTouches[0].screenY)},this.touchend=t=>{const e=this;if(this.multitouch){if(this.multitouch--,1===this.multitouch&&e.ship.totalAmmo.length>0){const t=e.ship.totalAmmo.pop();e.ship.shoot(e.spammos,e.ship.angle,t.imgId,10)}return}if(void 0===this.touchX||void 0===this.touchY)return;const s=window.innerWidth||document.body.clientWidth,i=Math.max(1,Math.floor(.01*s)),o=t.changedTouches[0].screenX,h=t.changedTouches[0].screenY,a=this.touchX,m=this.touchY;this.touchY=void 0,this.touchX=void 0;const r=Math.tan(.375*Math.PI);let n=o-a,l=h-m,d=Math.abs(n/l),p=Math.abs(l/n);if(Math.abs(n)>i||Math.abs(l)>i)return p<=r&&(n<0?e.ship.moveLeft():e.ship.moveRight()),void(d<=r&&(l<0?e.ship.moveUp():e.ship.moveDown()));e.ship.shoot(e.ammos,e.ship.angle,"ammo0")},document.addEventListener("touchstart",this.touchstart,{passive:!0}),document.addEventListener("touchend",this.touchend,{passive:!0})}stop(){this.loops.forEach(clearTimeout),cancelAnimationFrame(this.main),document.removeEventListener("keydown",this.keydown),document.removeEventListener("mousedown",this.mousedown),document.removeEventListener("contextmenu",this.contextmenu),document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchend",this.touchend)}},game.play()})();